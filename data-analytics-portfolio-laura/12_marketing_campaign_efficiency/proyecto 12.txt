{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "2bca2828-bdef-490b-b4db-cfde0ae3f886",
   "metadata": {},
   "source": [
    "### Test A & B ###\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "ad79eef6-21ae-4a9d-a48a-e7dd710e529b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(            user_id             event_dt event_name  details\n",
       " 0  E1BDDCE0DAFA2679  2020-12-07 20:22:03   purchase    99.99\n",
       " 1  7B6452F081F49504  2020-12-07 09:22:53   purchase     9.99\n",
       " 2  9CD9F34546DF254C  2020-12-07 12:59:29   purchase     4.99\n",
       " 3  96F27A054B191457  2020-12-07 04:02:40   purchase     4.99\n",
       " 4  1FD7660FDF94CA1F  2020-12-07 10:15:09   purchase     4.99,\n",
       "             user_id  first_date     region   device\n",
       " 0  D72A72121175D8BE  2020-12-07         EU       PC\n",
       " 1  F1C668619DFE6E65  2020-12-07  N.America  Android\n",
       " 2  2E1BF1D4C37EA01F  2020-12-07         EU       PC\n",
       " 3  50734A22C0C63768  2020-12-07         EU   iPhone\n",
       " 4  E1BDDCE0DAFA2679  2020-12-07  N.America   iPhone,\n",
       "             user_id group                  ab_test\n",
       " 0  D1ABA3E2887B6A73     A  recommender_system_test\n",
       " 1  A7A3664BD6242119     A  recommender_system_test\n",
       " 2  DABC14FDDFADD29E     A  recommender_system_test\n",
       " 3  04988C5DF189632E     A  recommender_system_test\n",
       " 4  4FF2998A348C484F     A  recommender_system_test,\n",
       "                            name                   regions    start_dt  \\\n",
       " 0      Christmas&New Year Promo             EU, N.America  2020-12-25   \n",
       " 1  St. Valentine's Day Giveaway  EU, CIS, APAC, N.America  2020-02-14   \n",
       " 2        St. Patric's Day Promo             EU, N.America  2020-03-17   \n",
       " 3                  Easter Promo  EU, CIS, APAC, N.America  2020-04-12   \n",
       " 4             4th of July Promo                 N.America  2020-07-04   \n",
       " \n",
       "     finish_dt  \n",
       " 0  2021-01-03  \n",
       " 1  2020-02-16  \n",
       " 2  2020-03-19  \n",
       " 3  2020-04-19  \n",
       " 4  2020-07-11  )"
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "from statsmodels.stats.proportion import proportions_ztest\n",
    "\n",
    "\n",
    "events   = pd.read_csv('datasets/final_ab_events_upd_us.txt')\n",
    "newusers = pd.read_csv('datasets/final_ab_new_users_upd_us.txt')\n",
    "parts    = pd.read_csv('datasets/final_ab_participants_upd_us.txt')\n",
    "mkt      = pd.read_csv('datasets/ab_project_marketing_events_us_(1).txt')\n",
    "\n",
    "events.head(), newusers.head(), parts.head(), mkt.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "ee5359f5-6e71-4848-be7c-5d614272671f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Usuarios EU elegibles: 39466\n",
      "Usuarios en experimento: 3481 | A: 2604 | B: 877\n",
      "Usuarios con eventos (14d): 3481\n"
     ]
    }
   ],
   "source": [
    "# Preparacion de datos \n",
    "\n",
    "# Convertir columnas de fecha\n",
    "events['event_dt']     = pd.to_datetime(events['event_dt'])\n",
    "newusers['first_date'] = pd.to_datetime(newusers['first_date'])\n",
    "mkt['start_dt']        = pd.to_datetime(mkt['start_dt'])\n",
    "mkt['finish_dt']       = pd.to_datetime(mkt['finish_dt'])\n",
    "\n",
    "# Ventanas\n",
    "start = pd.Timestamp('2020-12-07')  # inicio registro\n",
    "close = pd.Timestamp('2020-12-21')  # fin registro\n",
    "end   = pd.Timestamp('2021-01-01')  # fin datos de eventos\n",
    "\n",
    "# Filtrar: usuarios EU dentro de la ventana de registro\n",
    "newusers_elig = newusers.query(\"region == 'EU' and @start <= first_date <= @close\").copy()\n",
    "\n",
    "# Eventos solo de esos usuarios y dentro de la ventana global\n",
    "events_elig = events[(events['user_id'].isin(newusers_elig['user_id'])) &\n",
    "                     (events['event_dt'] <= end)].copy()\n",
    "\n",
    "# Quedarnos con la prueba correcta y grupos A/B v√°lidos\n",
    "parts_test = parts.query(\"ab_test == 'recommender_system_test' and group.isin(['A','B'])\").copy()\n",
    "\n",
    "# Usuarios finales del experimento (EU + fechas + asignados a A/B)\n",
    "users_AB = newusers_elig.merge(parts_test[['user_id','group']], on='user_id', how='inner')\n",
    "\n",
    "# Unir eventos con grupo y fecha de alta\n",
    "events_AB = events_elig.merge(users_AB[['user_id','group','first_date']], on='user_id', how='inner')\n",
    "\n",
    "# Limitar a 14 d√≠as post-registro por usuario\n",
    "events_AB = events_AB[events_AB['event_dt'] <= events_AB['first_date'] + pd.Timedelta(days=14)]\n",
    "\n",
    "# Si hubiera contaminaci√≥n (usuario en ambos grupos), conservamos primera asignaci√≥n\n",
    "if users_AB.duplicated('user_id').any():\n",
    "    users_AB = users_AB.drop_duplicates(subset='user_id', keep='first')\n",
    "    events_AB = events_AB[events_AB['user_id'].isin(users_AB['user_id'])]\n",
    "\n",
    "print(\"Usuarios EU elegibles:\", newusers_elig['user_id'].nunique())\n",
    "print(\"Usuarios en experimento:\", users_AB['user_id'].nunique(),\n",
    "      \"| A:\", (users_AB['group']=='A').sum(), \"| B:\", (users_AB['group']=='B').sum())\n",
    "print(\"Usuarios con eventos (14d):\", events_AB['user_id'].nunique())\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "c38307ce-84c9-434a-87d8-62a487993f0d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "login           9919\n",
      "product_page    6132\n",
      "purchase        2998\n",
      "product_cart    2903\n",
      "Name: event_name, dtype: int64\n",
      "\n",
      "Eventos normalizados:\n",
      "login           9919\n",
      "product_page    6132\n",
      "purchase        2998\n",
      "product_card    2903\n",
      "Name: event_name, dtype: int64\n"
     ]
    }
   ],
   "source": [
    "# EDA minimos \n",
    "\n",
    "# Normalizar a min√∫sculas y limpiar espacios\n",
    "events_AB['event_name'] = (events_AB['event_name']\n",
    "                           .astype(str).str.lower().str.replace(r'\\s+', ' ', regex=True).str.strip())\n",
    "\n",
    "# Ver eventos reales\n",
    "print(events_AB['event_name'].value_counts().head(20))\n",
    "\n",
    "# Mapeo \n",
    "alias = {\n",
    "    # Vistas de producto\n",
    "    'product page': 'product_page',\n",
    "    'product_page': 'product_page',\n",
    "    'product page view': 'product_page',\n",
    "    'view_product_page': 'product_page',\n",
    "\n",
    "    # A√±adir al carrito \n",
    "    'product cart': 'product_card',\n",
    "    'product_cart': 'product_card',\n",
    "    'product card': 'product_card',\n",
    "    'product_card': 'product_card',\n",
    "    'add to cart': 'product_card',\n",
    "    'add_to_cart': 'product_card',\n",
    "    'cart': 'product_card',\n",
    "\n",
    "    # Compra\n",
    "    'purchase': 'purchase',\n",
    "    'purchase completed': 'purchase',\n",
    "    'order_completed': 'purchase'\n",
    "}\n",
    "events_AB['event_name'] = events_AB['event_name'].replace(alias)\n",
    "\n",
    "print(\"\\nEventos normalizados:\")\n",
    "print(events_AB['event_name'].value_counts().head(10))\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "44192a13-dc7b-4dcc-8cb7-70298f45f128",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>base</th>\n",
       "      <th>product_page</th>\n",
       "      <th>product_card</th>\n",
       "      <th>purchase</th>\n",
       "      <th>card_given_page</th>\n",
       "      <th>buy_given_card</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>A</th>\n",
       "      <td>2604</td>\n",
       "      <td>1685</td>\n",
       "      <td>782</td>\n",
       "      <td>833</td>\n",
       "      <td>510</td>\n",
       "      <td>261</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>B</th>\n",
       "      <td>877</td>\n",
       "      <td>493</td>\n",
       "      <td>244</td>\n",
       "      <td>249</td>\n",
       "      <td>136</td>\n",
       "      <td>75</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   base  product_page  product_card  purchase  card_given_page  buy_given_card\n",
       "A  2604          1685           782       833              510             261\n",
       "B   877           493           244       249              136              75"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>CV1_base_to_page</th>\n",
       "      <th>CV2_page_to_card</th>\n",
       "      <th>CV3_card_to_buy</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>A</th>\n",
       "      <td>0.6471</td>\n",
       "      <td>0.3027</td>\n",
       "      <td>0.3338</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>B</th>\n",
       "      <td>0.5621</td>\n",
       "      <td>0.2759</td>\n",
       "      <td>0.3074</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   CV1_base_to_page  CV2_page_to_card  CV3_card_to_buy\n",
       "A            0.6471            0.3027           0.3338\n",
       "B            0.5621            0.2759           0.3074"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": [
       "CV1_base_to_page   -13.13\n",
       "CV2_page_to_card    -8.86\n",
       "CV3_card_to_buy     -7.90\n",
       "dtype: float64"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Embudo y conversiones \n",
    "\n",
    "\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "\n",
    "# Asegura eventos normalizados y mapeados antes de este bloque\n",
    "# stages = ['product_page','product_card','purchase']\n",
    "\n",
    "# 4.1: Conjuntos de usuarios por etapa y grupo\n",
    "def users_set(df, group, event):\n",
    "    return set(df[(df['group']==group) & (df['event_name']==event)]['user_id'].unique())\n",
    "\n",
    "groups = ['A','B']\n",
    "U = {\n",
    "    g: {\n",
    "        'base': set(users_AB[users_AB['group']==g]['user_id'].unique()),\n",
    "        'page': users_set(events_AB, g, 'product_page'),\n",
    "        'card': users_set(events_AB, g, 'product_card'),\n",
    "        'buy' : users_set(events_AB, g, 'purchase'),\n",
    "    } for g in groups\n",
    "}\n",
    "\n",
    "# 4.2: Construir tabla de conteos por etapa y condicionales\n",
    "# Conteos \"simples\"\n",
    "stage_counts_cond = pd.DataFrame({\n",
    "    'base'        : {g: len(U[g]['base']) for g in groups},\n",
    "    'product_page': {g: len(U[g]['page']) for g in groups},\n",
    "    'product_card': {g: len(U[g]['card']) for g in groups},\n",
    "    'purchase'    : {g: len(U[g]['buy'])  for g in groups},\n",
    "})\n",
    "\n",
    "# Conteos \"condicionales\" (numeradores de CV2 y CV3)\n",
    "stage_counts_cond['card_given_page'] = [\n",
    "    len(U['A']['card'] & U['A']['page']),\n",
    "    len(U['B']['card'] & U['B']['page'])\n",
    "]\n",
    "stage_counts_cond['buy_given_card'] = [\n",
    "    len(U['A']['buy'] & U['A']['card']),\n",
    "    len(U['B']['buy'] & U['B']['card'])\n",
    "]\n",
    "stage_counts_cond.index = groups\n",
    "\n",
    "display(stage_counts_cond)\n",
    "\n",
    "# 4.3: Conversiones CONDICIONALES (seguras)\n",
    "def safe_div(num, den):\n",
    "    num, den = float(num), float(den)\n",
    "    return 0.0 if den == 0 else num/den\n",
    "\n",
    "conv = pd.DataFrame(index=groups)\n",
    "conv.loc['A','CV1_base_to_page'] = safe_div(stage_counts_cond.loc['A','product_page'], stage_counts_cond.loc['A','base'])\n",
    "conv.loc['B','CV1_base_to_page'] = safe_div(stage_counts_cond.loc['B','product_page'], stage_counts_cond.loc['B','base'])\n",
    "\n",
    "conv.loc['A','CV2_page_to_card'] = safe_div(stage_counts_cond.loc['A','card_given_page'], stage_counts_cond.loc['A','product_page'])\n",
    "conv.loc['B','CV2_page_to_card'] = safe_div(stage_counts_cond.loc['B','card_given_page'], stage_counts_cond.loc['B','product_page'])\n",
    "\n",
    "conv.loc['A','CV3_card_to_buy']  = safe_div(stage_counts_cond.loc['A','buy_given_card'], stage_counts_cond.loc['A','product_card'])\n",
    "conv.loc['B','CV3_card_to_buy']  = safe_div(stage_counts_cond.loc['B','buy_given_card'], stage_counts_cond.loc['B','product_card'])\n",
    "\n",
    "display(conv.round(4))\n",
    "\n",
    "lift = 100 * (conv.loc['B'] / conv.loc['A'] - 1)\n",
    "display(lift.round(2))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "d1b2542e-ad2c-45a4-acb9-2e7394a204bb",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Umbral Bonferroni: p < 0.0167\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>z</th>\n",
       "      <th>p_value</th>\n",
       "      <th>sig_Bonf</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>CV1_base_to_page</th>\n",
       "      <td>4.495436</td>\n",
       "      <td>0.000007</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CV2_page_to_card</th>\n",
       "      <td>1.146252</td>\n",
       "      <td>0.251691</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CV3_card_to_buy</th>\n",
       "      <td>0.766645</td>\n",
       "      <td>0.443292</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                         z   p_value sig_Bonf\n",
       "CV1_base_to_page  4.495436  0.000007     True\n",
       "CV2_page_to_card  1.146252  0.251691    False\n",
       "CV3_card_to_buy   0.766645  0.443292    False"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Pruebas de proporciones Z\n",
    "\n",
    "from statsmodels.stats.proportion import proportions_ztest\n",
    "\n",
    "ALPHA = 0.05\n",
    "alpha_adj = ALPHA / 3  # Bonferroni\n",
    "\n",
    "def zprop(sA, nA, sB, nB):\n",
    "    # evita problemas cuando hay denominadores cero\n",
    "    if nA == 0 or nB == 0:\n",
    "        return (0.0, 1.0)\n",
    "    return proportions_ztest([sA, sB], [nA, nB], alternative='two-sided')\n",
    "\n",
    "tests = {}\n",
    "\n",
    "# CV1: base -> product_page\n",
    "tests['CV1_base_to_page'] = zprop(\n",
    "    stage_counts_cond.loc['A','product_page'], stage_counts_cond.loc['A','base'],\n",
    "    stage_counts_cond.loc['B','product_page'], stage_counts_cond.loc['B','base']\n",
    ")\n",
    "\n",
    "# CV2: product_page -> product_card  (usa intersecci√≥n como √©xitos y product_page como n)\n",
    "tests['CV2_page_to_card'] = zprop(\n",
    "    stage_counts_cond.loc['A','card_given_page'], stage_counts_cond.loc['A','product_page'],\n",
    "    stage_counts_cond.loc['B','card_given_page'], stage_counts_cond.loc['B','product_page']\n",
    ")\n",
    "\n",
    "# CV3: product_card -> purchase  (usa intersecci√≥n como √©xitos y product_card como n)\n",
    "tests['CV3_card_to_buy'] = zprop(\n",
    "    stage_counts_cond.loc['A','buy_given_card'], stage_counts_cond.loc['A','product_card'],\n",
    "    stage_counts_cond.loc['B','buy_given_card'], stage_counts_cond.loc['B','product_card']\n",
    ")\n",
    "\n",
    "res_tests = pd.DataFrame({k:{'z':v[0], 'p_value':v[1], 'sig_Bonf': v[1] < alpha_adj} for k,v in tests.items()}).T\n",
    "print(f\"Umbral Bonferroni: p < {alpha_adj:.4f}\")\n",
    "display(res_tests.round(6))\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "986e6428-a655-4882-bc19-6cef7fc8b560",
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'stage_counts' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "Cell \u001b[0;32mIn[6], line 14\u001b[0m\n\u001b[1;32m     11\u001b[0m summary_tests \u001b[38;5;241m=\u001b[39m res_tests\u001b[38;5;241m.\u001b[39mcopy()\n\u001b[1;32m     12\u001b[0m summary_tests\u001b[38;5;241m.\u001b[39mindex \u001b[38;5;241m=\u001b[39m [\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mCV1_base_to_page\u001b[39m\u001b[38;5;124m'\u001b[39m,\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mCV2_page_to_card\u001b[39m\u001b[38;5;124m'\u001b[39m,\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mCV3_card_to_buy\u001b[39m\u001b[38;5;124m'\u001b[39m]\n\u001b[0;32m---> 14\u001b[0m display(\u001b[43mstage_counts\u001b[49m)\n\u001b[1;32m     15\u001b[0m display(resumen)\n\u001b[1;32m     16\u001b[0m display(summary_tests[[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mp_value\u001b[39m\u001b[38;5;124m'\u001b[39m,\u001b[38;5;124m'\u001b[39m\u001b[38;5;124msig_Bonf\u001b[39m\u001b[38;5;124m'\u001b[39m]])\n",
      "\u001b[0;31mNameError\u001b[0m: name 'stage_counts' is not defined"
     ]
    }
   ],
   "source": [
    "# Resumen ejecutivo \n",
    "resumen = pd.concat({\n",
    "    'A': conv.loc['A'],\n",
    "    'B': conv.loc['B'],\n",
    "    'Lift_%(B/A-1)': lift\n",
    "}, axis=1).round(4)\n",
    "\n",
    "# ordenar filas para que queden prolijas\n",
    "resumen = resumen.loc[['CV1_base_to_page','CV2_page_to_card','CV3_card_to_buy']]\n",
    "\n",
    "summary_tests = res_tests.copy()\n",
    "summary_tests.index = ['CV1_base_to_page','CV2_page_to_card','CV3_card_to_buy']\n",
    "\n",
    "display(stage_counts)\n",
    "display(resumen)\n",
    "display(summary_tests[['p_value','sig_Bonf']])\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ca4c7be1-7987-47d2-b556-834133953e58",
   "metadata": {},
   "source": [
    "# üìã Conclusiones del experimento A/B ‚Äì `recommender_system_test`\n",
    "\n",
    "## üéØ Objetivo\n",
    "Evaluar si la introducci√≥n de un nuevo sistema de recomendaciones mejora la conversi√≥n en las etapas:\n",
    "`product_page ‚Üí product_card ‚Üí purchase`\n",
    "dentro de los 14 d√≠as posteriores al registro.\n",
    "\n",
    "---\n",
    "\n",
    "## üìä Resultados clave\n",
    "\n",
    "| Etapa | Grupo A | Grupo B | Lift (B/A-1) | p-value | Significativo |\n",
    "|:--|--:|--:|--:|--:|:--:|\n",
    "| Base ‚Üí Product Page | 0.6471 | 0.5621 | **-13.1 %** | 0.000007 | ‚úÖ S√≠ |\n",
    "| Product Page ‚Üí Product Card | 0.3027 | 0.2759 | **-8.9 %** | 0.2517 | ‚ùå No |\n",
    "| Product Card ‚Üí Purchase | 0.3338 | 0.3074 | **-7.9 %** | 0.4433 | ‚ùå No |\n",
    "\n",
    "**Umbral Bonferroni:** p < 0.0167  \n",
    "**Criterio de √©xito:** lift ‚â• +10 % y p < 0.0167\n",
    "\n",
    "---\n",
    "\n",
    "## üß© Interpretaci√≥n\n",
    "\n",
    "- Solo la **primera etapa** presenta una diferencia significativa, **a favor del grupo de control (A)**.  \n",
    "- En promedio, el nuevo sistema **reduce las vistas de producto en un 13 %** respecto al grupo A.  \n",
    "- Las conversiones en las siguientes etapas tambi√©n disminuyen, pero no de forma significativa.  \n",
    "- No se observ√≥ ning√∫n incremento ‚â• 10 % en ninguna parte del embudo.\n",
    "\n",
    "---\n",
    "\n",
    "## üö´ Conclusi√≥n general\n",
    "\n",
    "El experimento **no cumple con los criterios de √©xito** definidos.  \n",
    "El nuevo sistema de recomendaciones **no mejora la conversi√≥n** y, de hecho, la reduce ligeramente en todas las etapas.  \n",
    "\n",
    "**Recomendaci√≥n:**  \n",
    "No implementar el nuevo sistema en producci√≥n. Se sugiere revisar:\n",
    "- La relevancia de los productos mostrados.\n",
    "- El orden o cantidad de recomendaciones.\n",
    "- Posibles problemas de usabilidad en la etapa inicial (acceso a p√°ginas de producto).\n",
    "\n",
    "---\n",
    "\n",
    "##  Recomendaciones \n",
    "\n",
    "- Realizar un **an√°lisis cualitativo** de los clics o comportamiento inicial para entender por qu√© los usuarios del grupo B exploran menos productos.  \n",
    "- Considerar un **nuevo test A/B** con ajustes en la l√≥gica de recomendaciones o una muestra m√°s grande para validar los resultados.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "992c9618-9dcd-4aa4-95ef-e971c26d7a63",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.23"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
